<html>

<head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>
    <svg width="1024" height="960"></svg>
    <script>
        // Config
        const svg = d3.select('svg');
        const width = svg._groups[0][0].width.baseVal.value;
        const height = svg._groups[0][0].height.baseVal.value;
        const colourSet = d3.scaleOrdinal(d3.schemeCategory10);
        const groups = {
            "Physical Application Component": 1,
            "Physical Data Component": 2,
        }

        // Values
        const nodes = [
            {{ range .OBJS -}}
            { id: "{{ .ObjectID }}", group: groups["{{ .ObjectType.Name }}"], name: "{{ .Name }}", type: "{{ .ObjectType.Name }}" },
            {{ end }}
        ];
        const links = [
            {{ range .LNKS -}}
            { source: "{{ .LeadObjectID }}", target: "{{ .MemberObjectID }}", value: "9" },
            {{ end }}
        ];

        // Physics
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id))
            .force("charge", d3.forceManyBody())
            .force("center", d3.forceCenter(width / 2, height / 2));

        // Drawing
        const link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links)
            .enter()
            .append("line")
            .attr('stroke', d => '#f00')
            .attr("stroke-width", d => Math.sqrt(d.value));
        const node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes)
            .enter()
            .append("circle")
            .attr("r", 5)
            .attr("fill", d => colourSet(d.group));
        const text = svg.append("g")
            .attr("class", "labels")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("dx", 12)
            .attr("dy", ".35em")
            .text(function (d) { return d.name });

        // Refreshing
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            text
                .attr("dx", d => d.x)
                .attr("dy", d=> d.y);

        });

        // Interaction
        function drag(simulation) {
            function dragstarted(event) { if (!event.active) simulation.alphaTarget(0.3).restart(); event.subject.fx = event.subject.x; event.subject.fy = event.subject.y; }
            function dragged(event) { event.subject.fx = event.x; event.subject.fy = event.y; }
            function dragended(event) { if (!event.active) simulation.alphaTarget(0); event.subject.fx = null; event.subject.fy = null; }
            return d3.drag().on('start', dragstarted).on('drag', dragged).on('end', dragended);
        }
        node.call(drag(simulation));
    </script>
</body>

</html>